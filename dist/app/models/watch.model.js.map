{"version":3,"file":"watch.model.js","sourceRoot":"","sources":["watch.model.ts"],"names":[],"mappings":"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","sourcesContent":["import { Measure, MeasureStatus } from './measure.model'\nimport {Wove} from 'aspect.js/dist/lib/aspect';\nimport { LoggerAspect } from './../aspects/logger.aspect'\n\n\n@Wove(LoggerAspect)\nexport class Watch{\n\tid:number;\n\tbrand:string;\n\thistorySize:number;\n\tmeasures:Measure[];\n\tname:string;\n\tyearOfBuy:number;\n\tserial:string;\n\tcaliber:string;\n\tstatus: WatchStatus;\n\tnext: WatchAction;\n\twaiting:number;\n\tinitials:string;\n\n\tconstructor(id: number, brand: string, historySize: number = 0,\n\t\tmeasures: Measure[] = [], name: string = \"\", yearOfBuy: number = null,\n\t\tserial: string = \"\", caliber: string = \"\") {\n\n\t\tthis.id = id;\n\t\tthis.brand = brand;\n\t\tthis.historySize = historySize;\n\t\tthis.measures = measures.sort(function(a:Measure, b:Measure){\n\t\t\treturn a.id - b.id;\n\t\t});\n\t\tthis.name = name;\n\t\tthis.yearOfBuy = yearOfBuy;\n\t\tthis.serial = serial;\n\t\tthis.caliber = caliber;\n\t\tthis.initials = this.brand.charAt(0);\n\t\tthis.initials += (this.name.length > 0) ? this.name.charAt(0) : \"\";\n\n\t\tif (historySize == 0){\n\t\t\tthis.status = WatchStatus.NeverMeasured;\n\t\t\tthis.next = WatchAction.Measure;\n\t\t}else if(historySize > this.measures.length){\n\t\t\tthis.status = WatchStatus.HaveMoreMeasures;\n\t\t}\n\n\t\tlet lastMeasure = this.currentMeasure();\n\t\tif (lastMeasure !== null \n\t\t\t&& lastMeasure.status & MeasureStatus.BaseMeasure){\n\t\t\t\n\t\t\tif (Math.abs((lastMeasure.measureUserTime - Date.now()/1000)/3600) < 12){\n\t\t\t\tthis.next = WatchAction.Waiting;\n\t\t\t\tthis.waiting = Math.round(12 - Math.abs((lastMeasure.measureUserTime - Date.now()/1000)/3600));\n\t\t\t}else if(!(lastMeasure.status & MeasureStatus.AccuracyMeasure)) {\n\t\t\t\tthis.next = WatchAction.Accuracy;\n\t\t\t}else{\n\t\t\t\tthis.next = WatchAction.Measure;\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(this);\n\t\tconsole.log(this.lastCompleteMeasure());\n\n\t}\n\n\tpublic toString = () : string => {\n\t\treturn `Watch (id: ${this.id},\n\t\t\t\tbrand: ${this.brand},\n\t\t\t\thistorySize: ${this.historySize},\n\t\t\t\tmeasures: ${this.measures},\n\t\t\t\tname: ${this.name},\n\t\t\t\tyearOfBuy: ${this.yearOfBuy},\n\t\t\t\tserial: ${this.serial},\n\t\t\t\tcaliber: ${this.caliber},\n\t\t\t\tstatus: ${this.status},\n\t\t\t\tnext: ${this.next},\n\t\t\t\twaiting: ${this.waiting})`;\n\t}\n\n\taverage(amount:number){\n\n\t\tlet actualAmount:number = 0;\n\t\tlet average:number = 0;\n\t\tlet i:number = this.measures.length - 1;\n\n\t\twhile(i>= 0 && actualAmount <= amount){\n\t\t\tif(this.measures[i].status & MeasureStatus.AccuracyMeasure){\n\t\t\t\taverage = average + Math.abs(this.measures[i].accuracy);\n\t\t\t\tactualAmount++;\n\t\t\t}\n\t\t\t\n\t\t\ti--;\n\t\t\t\n\t\t}\n\t\treturn (average/actualAmount).toFixed(1);\n\t}\n\n\tlastCompleteMeasure():Measure{\n\t\tlet i:number = this.measures.length - 1;\n\n\t\twhile(i >= 0){\n\t\t\tif(this.measures[i].status & MeasureStatus.AccuracyMeasure){\n\t\t\t\treturn this.measures[i];\n\t\t\t}\n\t\t\t\n\t\t\ti--;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcurrentMeasure():Measure{\n\t\tif(this.measures.length !== 0){\n\t\t\treturn this.measures[this.measures.length - 1];\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tupsertMeasure(measure:Measure){\n\n\t\tfor (var i = 0; i < this.measures.length; i++) {\n\t\t\tconsole.log(\"i\", i);\n\t\t\tif(this.measures[i].id == measure.id){\n\t\t\t\tthis.measures[i] = measure;\n\t\t\t\tconsole.log(\"return\", this, this.measures[i], measure);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.historySize++;\n\t\tthis.measures.push(measure);\n\t}\n}\n\nexport enum WatchAction{\n\tMeasure, Waiting, Accuracy\n}\n\nexport enum WatchStatus{\n\tNeverMeasured,\n\tHaveMoreMeasures\n}"]}