{"version":3,"file":"astro.js","sourceRoot":"","sources":["astro.ts"],"names":[],"mappings":"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","sourcesContent":["import { Wove } from 'aspect.js/dist/lib/aspect';\nimport { LoggerAspect } from './../../aspects/logger.aspect';\n\n@Wove(LoggerAspect)\nexport class Astro {\n\n\tprotected PI = Math.PI;\n\tprotected sin = Math.sin;\n\tprotected cos = Math.cos;\n\tprotected tan = Math.tan;\n\tprotected asin = Math.asin;\n\tprotected atan = Math.atan2;\n\tprotected acos = Math.acos;\n\tprotected rad = this.PI / 180;\n\tprotected dayMs = 1000 * 60 * 60 * 24;\n\tprotected J1970 = 2440588;\n\tprotected J2000 = 2451545;\n\tprotected e = this.rad * 23.4397;\n\tprotected illum: { fraction: number, phase: number, angle: number };\n\tprotected pos: { azimuth: number, altitude: number, distance: number, parallacticAngle: number }\n\tprotected angleMoon: number;\n\n\tprotected toJulian(date) { return date.valueOf() / this.dayMs - 0.5 + this.J1970; }\n\tprotected fromJulian(j) { return new Date((j + 0.5 - this.J1970) * this.dayMs); }\n\tprotected toDays(date) { return this.toJulian(date) - this.J2000; }\n\tprotected rightAscension(l, b) { return this.atan(this.sin(l) * this.cos(this.e) - this.tan(b) * this.sin(this.e), this.cos(l)); }\n\tprotected declination(l, b) { return this.asin(this.sin(b) * this.cos(this.e) + this.cos(b) * this.sin(this.e) * this.sin(l)); }\n\tprotected azimuth(H, phi, dec) { return this.atan(this.sin(H), this.cos(H) * this.sin(phi) - this.tan(dec) * this.cos(phi)); }\n\tprotected altitude(H, phi, dec) { return this.asin(this.sin(phi) * this.sin(dec) + this.cos(phi) * this.cos(dec) * this.cos(H)); }\n\tprotected solarMeanAnomaly(d) { return this.rad * (357.5291 + 0.98560028 * d); }\n\tprotected siderealTime(d, lw) { return this.rad * (280.16 + 360.9856235 * d) - lw; }\n\n\tprotected astroRefraction(h) {\n\t\tif (h < 0) // the following formula works for positive altitudes only.\n\t\t\th = 0; // if h = -0.08901179 a div/0 would occur.\n\n\t\t// formula 16.4 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n\t\t// 1.02 / tan(h + 10.26 / (h + 5.10)) h in degrees, result in arc minutes -> converted to rad:\n\t\treturn 0.0002967 / this.tan(h + 0.00312536 / (h + 0.08901179));\n\t}\n\n\tprotected eclipticLongitude(M) {\n\n\t\tvar C = this.rad * (1.9148 * this.sin(M) + 0.02 * this.sin(2 * M) + 0.0003 * this.sin(3 * M)), // equation of center\n\t\t\tP = this.rad * 102.9372; // perihelion of the Earth\n\n\t\treturn M + C + P + this.PI;\n\t}\n\n\tprotected sunCoords(d) {\n\t\tvar M = this.solarMeanAnomaly(d),\n\t\t\tL = this.eclipticLongitude(M);\n\n\t\treturn {\n\t\t\tdec: this.declination(L, 0),\n\t\t\tra: this.rightAscension(L, 0)\n\t\t};\n\t}\n\n\tprotected moonCoords(d) { // geocentric ecliptic coordinates of the moon\n\n\t\tvar L = this.rad * (218.316 + 13.176396 * d), // ecliptic longitude\n\t\t\tM = this.rad * (134.963 + 13.064993 * d), // mean anomaly\n\t\t\tF = this.rad * (93.272 + 13.229350 * d),  // mean distance\n\n\t\t\tl = L + this.rad * 6.289 * this.sin(M), // longitude\n\t\t\tb = this.rad * 5.128 * this.sin(F),     // latitude\n\t\t\tdt = 385001 - 20905 * this.cos(M);  // distance to the moon in km\n\n\t\treturn {\n\t\t\tra: this.rightAscension(l, b),\n\t\t\tdec: this.declination(l, b),\n\t\t\tdist: dt\n\t\t};\n\t}\n\n\tprotected getMoonPosition(date, lat, lng) {\n\n\t\tvar lw = this.rad * -lng,\n\t\t\tphi = this.rad * lat,\n\t\t\td = this.toDays(date),\n\n\t\t\tc = this.moonCoords(d),\n\t\t\tH = this.siderealTime(d, lw) - c.ra,\n\t\t\th = this.altitude(H, phi, c.dec),\n\t\t\t// formula 14.1 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n\t\t\tpa = this.atan(this.sin(H), this.tan(phi) * this.cos(c.dec) - this.sin(c.dec) * this.cos(H));\n\n\t\th = h + this.astroRefraction(h); // altitude correction for refraction\n\n\t\treturn {\n\t\t\tazimuth: this.azimuth(H, phi, c.dec),\n\t\t\taltitude: h,\n\t\t\tdistance: c.dist,\n\t\t\tparallacticAngle: pa\n\t\t};\n\t};\n\n\t/**\n\t *  calculations for illumination parameters of the moon,\n  // based on http://idlastro.gsfc.nasa.gov/ftp/pro/astro/mphase.pro formulas and\n  // Chapter 48 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n\t * @param {[type]} date [description]\n\t */\n\tprotected getMoonIllumination(date) {\n\n\t\tlet d = this.toDays(date),\n\t\t\ts = this.sunCoords(d),\n\t\t\tm = this.moonCoords(d),\n\n\t\t\tsdist = 149598000, // distance from Earth to Sun in km\n\n\t\t\tphi = this.acos(this.sin(s.dec) * this.sin(m.dec) + this.cos(s.dec) * this.cos(m.dec) * this.cos(s.ra - m.ra)),\n\t\t\tinc = this.atan(sdist * this.sin(phi), m.dist - sdist * this.cos(phi)),\n\t\t\tangle = this.atan(this.cos(s.dec) * this.sin(s.ra - m.ra), this.sin(s.dec) * this.cos(m.dec) -\n\t\t\t\tthis.cos(s.dec) * this.sin(m.dec) * this.cos(s.ra - m.ra));\n\n\t\treturn {\n\t\t\tfraction: (1 + this.cos(inc)) / 2,\n\t\t\tphase: 0.5 + 0.5 * inc * (angle < 0 ? -1 : 1) / Math.PI,\n\t\t\tangle: angle\n\t\t};\n\t};\n}\n"]}