{"version":3,"file":"login.component.js","sourceRoot":"","sources":["login.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Output, OnInit, EventEmitter } from '@angular/core';\nimport {TRANSLATE_PROVIDERS, TranslateService, TranslatePipe, TranslateLoader, TranslateStaticLoader} from 'ng2-translate/ng2-translate';\nimport {FORM_DIRECTIVES, FormBuilder, Control, ControlGroup, Validators}  from '@angular/common';\nimport {TwAPIService} from './../../services/twapi.service'\nimport {Http, HTTP_PROVIDERS, Headers}  from '@angular/http';\nimport { MD_BUTTON_DIRECTIVES } from '@angular2-material/button';\nimport { GlobalValidator } from './../global-validator';\nimport { GAService } from './../../services/ga.service';\n\nimport { Wove } from 'aspect.js/dist/lib/aspect';\nimport { LoggerAspect } from './../../aspects/logger.aspect';\n\n@Wove(LoggerAspect)\n@Component({\n  selector: 'app-login',\n  templateUrl: 'app/directives/login/login.component.html',\n  styleUrls: ['app/directives/login/login.component.css'],\n  pipes: [TranslatePipe],\n  providers: [TwAPIService, HTTP_PROVIDERS],\n  directives: [FORM_DIRECTIVES, MD_BUTTON_DIRECTIVES]\n})\n/**\n * Login component. Provides a login form with controlled and\n * emits a User ($event userLogged) on successful login.\n */\nexport class LoginComponent implements OnInit {\n\n  loginForm: ControlGroup;\n  email:Control;\n  password: Control;\n  submitAttempt:boolean = false;\n  credientials = false;\n  error = false;\n  @Output() userLogged = new EventEmitter();\n  @Output() loginAttempt = new EventEmitter();\n  @Output() loginError = new EventEmitter();\n\n  /**\n   * Constructor w/ service injection\n   * @param {TranslateService} private translate [description]\n   * @param {TwAPIService}     private twapi     [description]\n   * @param {FormBuilder}      private builder   [description]\n   */\n  constructor(private translate: TranslateService, \n    protected twapi: TwAPIService, private builder: FormBuilder) { \n  \t\n    //Lang definition\n\t  translate.setDefaultLang('en');\n\t  translate.use('en');\n\n    //Form constraints\n    this.password = new Control('', Validators.required);\n    this.email = new Control('', Validators.compose([Validators.required, GlobalValidator.mailFormat]));\n\n    this.loginForm = builder.group({\n      email: this.email,\n      password: this.password\n    });\n  }\n\n  /**\n   * Form submit\n   * @param {string}} user [description]\n   */\n  onSubmit(user:{email:string, password:string}){\n\n    this.loginAttempt.emit(true);\n\n    this.submitAttempt = true;\n    this.error = false;\n    this.credientials = false;\n\n    //Form constraints are ok\n    if(this.loginForm.valid){\n      this.twapi.login(user.email, user.password).then(\n        res => { \n          this.userLogged.emit(res);\n          GAService.event('CTA', 'LOGIN', 'SUCCESS');\n        }, \n        err => {\n          GAService.event('CTA', 'LOGIN', 'FAIL');\n          this.loginAttempt.emit(false);\n\n          switch (err.status) {\n            case 401:\n              this.credientials = true;\n              break;\n            default:\n              this.error = true;\n              break;\n          }\n        }\n      );\n    }else{\n      this.loginAttempt.emit(false);\n    }\n  }\n\n  ngOnInit() {\n  }\n\n}\n"]}